{{- $dot := . }}
{{- $providerName := $dot.Values.providers.default -}}
{{- $model := index $dot.Values.providers  $providerName }}
---
apiVersion: kagent.dev/v1alpha1
kind: ModelConfig
metadata:
  name: {{ include "kagent.defaultModelConfigName" $dot | quote }}
  namespace: {{ include "kagent.namespace" . }}
  labels:
    {{- include "kagent.labels" $dot | nindent 4 }}
spec:
  {{- with $model }}
  provider: {{ .provider | quote }}
  model: {{ .model | quote }}
  {{- if .apiKeySecretRef }}
  apiKeySecretRef: {{.apiKeySecretRef}}
  {{- end }}
  {{- if .apiKeySecretKey }}
  apiKeySecretKey: {{.apiKeySecretKey}}
  {{- end }}
  {{- if .defaultHeaders}}
  defaultHeaders:
  {{- toYaml .defaultHeaders | nindent 4 }}
  {{- end}}}
  {{ $providerName }}:
  {{- toYaml .config | nindent 4 }}
  {{- end}}