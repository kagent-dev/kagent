suite: test slackbot secret
templates:
  - slackbot-secret.yaml
tests:
  - it: should not create secret when slackbot is disabled
    set:
      slackbot.enabled: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should create secret when slackbot is enabled
    set:
      slackbot.enabled: true
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: metadata.name
          value: RELEASE-NAME-slackbot-secrets
      - equal:
          path: type
          value: Opaque

  - it: should include all required secret keys
    set:
      slackbot.enabled: true
    asserts:
      - exists:
          path: stringData["slack-bot-token"]
      - exists:
          path: stringData["slack-app-token"]
      - exists:
          path: stringData["slack-signing-secret"]

  - it: should use provided token values
    set:
      slackbot.enabled: true
      slackbot.secrets.slackBotToken: "xoxb-123456"
      slackbot.secrets.slackAppToken: "xapp-789012"
      slackbot.secrets.slackSigningSecret: "secret123"
    asserts:
      - equal:
          path: stringData["slack-bot-token"]
          value: "xoxb-123456"
      - equal:
          path: stringData["slack-app-token"]
          value: "xapp-789012"
      - equal:
          path: stringData["slack-signing-secret"]
          value: "secret123"

  - it: should have empty strings when tokens not provided
    set:
      slackbot.enabled: true
    asserts:
      - equal:
          path: stringData["slack-bot-token"]
          value: ""
      - equal:
          path: stringData["slack-app-token"]
          value: ""
      - equal:
          path: stringData["slack-signing-secret"]
          value: ""
