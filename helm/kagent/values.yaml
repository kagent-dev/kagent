# Default values for kagent

# ==============================================================================
# GLOBAL CONFIGURATION
# ==============================================================================

tag: ""
registry: "cr.kagent.dev"


imagePullSecrets: []
imagePullPolicy: IfNotPresent

nameOverride: ""
fullnameOverride: ""

# -- Override the namespace
# @default -- `.Release.Namespace`
namespaceOverride: ""

podAnnotations: {}

# -- Additional labels to add to all Kubernetes resources
labels: {}
  # environment: production
  # team: platform

podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# ==============================================================================
# CORE KAGENT COMPONENTS
# ==============================================================================

# -- Node taints which will be tolerated for `Pod` [scheduling](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/).
tolerations: []

# -- Node labels to match for `Pod` [scheduling](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/).
nodeSelector: {}

# ==============================================================================
# DATABASE CONFIGURATION
# ==============================================================================

database:
  type: sqlite
  sqlite:
    databaseName: kagent.db
  postgres:
    url: postgres://postgres:kagent@pgsql-postgresql.kagent.svc.cluster.local:5432/postgres

# ==============================================================================
# CONTROLLER CONFIGURATION
# ==============================================================================

controller:
  replicas: 1
  loglevel: "info"
  # Authentication mode: "unsecure" (default) or "proxy"
  # - unsecure: uses X-User-Id header/query param or defaults to admin@kagent.dev
  # - proxy: trusts JWT token from Authorization header (set by oauth2-proxy)
  auth:
    mode: unsecure
    # JWT claim mapping configuration (only used when mode: proxy)
    # These are optional - sensible defaults are used if not specified
    jwt:
      claims:
        # Claim name for user ID (default: "sub")
        userId: ""
        # Claim name for email (default: "email")
        email: ""
        # Claim name for display name (default: tries "name", then "preferred_username")
        name: ""
        # Claim name for groups (default: tries "groups", "cognito:groups", "roles")
        groups: ""
  agentImage:
    registry: ""
    repository: kagent-dev/kagent/app
    tag: "" # Will default to global, then Chart version
    pullPolicy: ""
  streaming: # Streaming buffer size for A2A communication
    maxBufSize: 1Mi # 1024 * 1024
    initialBufSize: 4Ki # 4 * 1024
    timeout: 600s # 600 seconds
  # -- Namespaces the controller should watch.
  # If empty, the controller will watch ALL available namespaces.
  # @default -- [] (watches all available namespaces)
  watchNamespaces: []
  #  - watch-ns-1
  #  - watch-ns-2

  # -- Node taints which will be tolerated for `Pod` [scheduling](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/).
  tolerations: []

  # -- Node labels to match for `Pod` [scheduling](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/).
  nodeSelector: {}

  image:
    registry: ""
    repository: kagent-dev/kagent/controller
    tag: "" # Will default to global, then Chart version
    pullPolicy: ""
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 2
      memory: 512Mi
  service:
    type: ClusterIP
    ports:
      port: 8083
      targetPort: 8083
  env: []

# Additional volumes on the output Deployment definition.
  volumes: []
#   - name: foo
#     secret:
#       secretName: mysecret
#       optional: false

# Additional volumeMounts on the output Deployment definition.
  volumeMounts: []
#   - name: foo
#     mountPath: "/etc/foo"
#     readOnly: true

# ==============================================================================
# UI CONFIGURATION
# ==============================================================================

ui:
  replicas: 1
  image:
    registry: ""
    repository: kagent-dev/kagent/ui
    tag: ""
    pullPolicy: ""
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  service:
    type: ClusterIP
    ports:
      port: 8080
      targetPort: 8080
  # Authentication redirect configuration
  # Change this if using a different auth proxy (e.g., Pomerium, Authelia)
  auth:
    # Path to redirect users to when they click "Sign in with SSO" on the login page
    # Default: /oauth2/start (oauth2-proxy's authentication start endpoint)
    ssoRedirectPath: "/oauth2/start"
  env: {} # Additional configuration key-value pairs for the ui ConfigMap

  # -- Node taints which will be tolerated for `Pod` [scheduling](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/).
  tolerations: []

  # -- Node labels to match for `Pod` [scheduling](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/).
  nodeSelector: {}

# ==============================================================================
# LLM PROVIDERS CONFIGURATION
# ==============================================================================
# https://kagent.dev/docs/getting-started/configuring-providers

providers:
  default: openAI
  openAI:
    provider: OpenAI
    model: "gpt-4.1-mini"
    apiKeySecretRef: kagent-openai
    apiKeySecretKey: OPENAI_API_KEY
    # apiKey: ""
  ollama:
    provider: Ollama
    model: "llama3.2"
    config:
      host: host.docker.internal:11434
  anthropic:
    provider: Anthropic
    model: "claude-3-5-haiku-20241022"
    apiKeySecretRef: kagent-anthropic
    apiKeySecretKey: ANTHROPIC_API_KEY
    # apiKey: ""
  azureOpenAI:
    provider: AzureOpenAI
    model: "gpt-4.1-mini"
    apiKeySecretRef: kagent-azure-openai
    apiKeySecretKey: AZUREOPENAI_API_KEY
    # apiKey: ""
    config:
      apiVersion: "2023-05-15"
      azureAdToken: ""
      azureDeployment: ""
      azureEndpoint: ""
  gemini:
    provider: Gemini
    model: "gemini-2.0-flash-lite"
    apiKeySecretRef: kagent-gemini
    apiKeySecretKey: GOOGLE_API_KEY
    # apiKey: ""

# ==============================================================================
# KMCP
# ==============================================================================

kmcp:
  enabled: true
  nameOverride: "kmcp"
  fullnameOverride: "" # Override if desired
  namespaceOverride: "" # Override if desired (in conjunction with fullnameOverride to drop the `kagent-` prefix if you want)
  image:
    tag: "0.1.9" # Required until https://github.com/kagent-dev/kmcp/issues/74 is resolved
  # See https://github.com/kagent-dev/kmcp/blob/main/helm/kmcp/values.yaml for chart values

# ==============================================================================
# BUILT-IN TOOLS
# ==============================================================================

kagent-tools:
  fullnameOverride: kagent-tools
  enabled: true
  replicaCount: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  tools:
    loglevel: "debug"

# ==============================================================================
# AGENTS
# ==============================================================================

agents:
  k8s-agent:
    enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
  kgateway-agent:
    enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
  istio-agent:
    enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
  promql-agent:
    enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
  observability-agent:
    enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
  argo-rollouts-agent:
    enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
  helm-agent:
    enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
  cilium-policy-agent:
    enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
  cilium-manager-agent:
    enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
  cilium-debug-agent:
    enabled: true
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi

# ==============================================================================
# MCP TOOLS
# ==============================================================================

tools:
  grafana-mcp:
    enabled: true
  querydoc:
    enabled: true

grafana-mcp:
  grafana:
    url: "grafana.kagent:3000/api"
    apiKey: "-"
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

querydoc:
  replicas: 1
  image:
    registry: ghcr.io
    repository: kagent-dev/doc2vec/mcp
    tag: 1.1.13
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  openai:
    apiKey: ""

# ==============================================================================
# OAUTH2-PROXY CONFIGURATION (Optional)
# ==============================================================================
# Enable oauth2-proxy subchart for OIDC authentication
# Requires controller.auth.mode: proxy

oauth2-proxy:
  enabled: false

  # Disable Redis - use cookie-based sessions
  redis:
    enabled: false
  sessionStorage:
    type: cookie

  # Mount custom templates for branded login redirect
  # The ConfigMap is created by templates/oauth2-proxy-templates.yaml
  extraVolumes:
    - name: custom-templates
      configMap:
        name: kagent-oauth2-proxy-templates

  extraVolumeMounts:
    - name: custom-templates
      mountPath: /templates
      readOnly: true

  # Mount custom CA certificate for TLS verification (if needed)
  # Add to extraVolumes:
  #   - name: custom-ca-cert
  #     secret:
  #       secretName: my-ca-cert
  #       items:
  #         - key: ca.crt
  #           path: ca.crt
  # Add to extraVolumeMounts:
  #   - name: custom-ca-cert
  #     mountPath: /etc/ssl/certs/custom-ca.crt
  #     subPath: ca.crt
  #     readOnly: true
  # Add to extraEnv:
  #   - name: SSL_CERT_FILE
  #     value: /etc/ssl/certs/custom-ca.crt

  config:
    # Option 1: Reference existing secret (recommended for production)
    # Secret must contain: client-id, client-secret, cookie-secret
    existingSecret: ""

    # Option 2: Inline values (for dev/testing only, chart creates secret)
    clientID: ""
    clientSecret: ""
    cookieSecret: ""

  # Cluster-specific OIDC settings - override these per deployment
  # These are set as env vars and referenced in args for easy patching
  extraEnv:
    - name: OIDC_ISSUER_URL
      value: ""
    - name: OIDC_REDIRECT_URL
      value: ""
    # Default assumes release name "kagent". Override if using different release name.
    - name: UPSTREAM_URL
      value: "http://kagent-ui:8080"

  # extraArgs as a map - each key becomes --key=value in container args
  # Uses $(VAR_NAME) syntax to reference env vars set above
  extraArgs:
    provider: oidc
    oidc-issuer-url: "$(OIDC_ISSUER_URL)"
    redirect-url: "$(OIDC_REDIRECT_URL)"
    upstream: "$(UPSTREAM_URL)"
    email-domain: "*"
    pass-authorization-header: true
    set-authorization-header: true
    approval-prompt: "auto"
    scope: "openid profile email groups"
    # Cookie security settings
    cookie-secure: true
    cookie-samesite: "lax"
    # Allow API clients with valid JWT tokens to bypass OIDC flow
    skip-jwt-bearer-tokens: true
    # Skip authentication for kagent's branded login page, health checks, and static assets
    # This allows unauthenticated users to see the landing page and k8s probes to work
    skip-auth-route: "^/(health|login)$"
    skip-auth-regex: "^/(login|_next/static|_next/image|login-bg\\.(jpg|png|webp)|logo-.*\\.png|favicon\\.ico).*$"
    # Use custom templates that redirect to kagent's branded /login page
    custom-templates-dir: "/templates"

  service:
    type: ClusterIP
    portNumber: 4180

# ==============================================================================
# NETWORK POLICY CONFIGURATION
# ==============================================================================
# NetworkPolicies are automatically enabled when auth is configured
# They restrict access to UI and Controller to only allow traffic from oauth2-proxy
# and internal cluster communication

networkPolicy:
  # Set to false to disable network policies even when auth is enabled
  enabled: true
  # Additional pod selector labels for oauth2-proxy (if using custom labels)
  oauth2ProxySelector: {}

# ==============================================================================
# OBSERVABILITY
# ==============================================================================

otel:
  tracing:
    enabled: false
    exporter:
      otlp:
        endpoint: http://host.docker.internal:4317
        timeout: 15
        insecure: true
  logging:
    enabled: false
    exporter:
      otlp:
        endpoint: http://host.docker.internal:4317
        timeout: 15
        insecure: true
